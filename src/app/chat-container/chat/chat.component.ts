import { Component } from '@angular/core';
import { HelperService } from 'src/app/helper.service';
import { WebSocketService } from 'src/app/web-socket.service';
import { DomSanitizer, SafeResourceUrl } from '@angular/platform-browser';

@Component({
  selector: 'app-chat',
  templateUrl: './chat.component.html',
  styleUrls: ['./chat.component.css'],
})
export class ChatComponent {
  imgURL: any = "";
  file: any = null;
  status: string = "none";
  toggledEmojiCont: boolean = false;
  emojis: string[] = ["😀", "😃", "😄", "😁", "😆", "😅", "😂", "🤣", "😊", "😇", "🙂", "🙃", "😉", "😌", "😍", "🥰", "😘", "😗", "😙", "😚", "😋", "😛", "😝", "😜", "🤪", "🤨", "🧐", "🤓", "😎", "🤩", "🥳", "😏", "😒", "😞", "😔", "😟", "😕", "🙁", "☹️", "😣", "😖", "😫", "😩", "🥺", "😢", "😭", "😤", "😠", "😡", "🤬", "🤯", "😳", "🥵", "🥶", "😱", "😨", "😰", "😥", "😓", "🤗", "🤔", "🤭", "🤫", "🤥", "😶", "😐", "😑", "😬", "🙄", "😯", "😦", "😧", "😮", "😲", "🥱", "😴", "🤤", "😪", "😵", "🤐", "🥴", "🤢", "🤮", "🤧", "😷", "🤒", "🤕", "🤑", "🤠", "😈", "👿", "👹", "👺", "🤡", "💩", "👻", "💀", "☠️", "👽", "👾", "🤖", "🎃", "😺", "😸", "😹", "😻", "😼", "😽", "🙀", "😿", "😾", "👋", "🤚", "🖐", "✋", "🖖", "👌", "🤏", "✌️", "🤞", "🤟", "🤘", "🤙", "👈", "👉", "👆", "🖕", "👇", "☝️", "👍", "👎", "✊", "👊", "🤛", "🤜", "👏", "🙌", "👐", "🤲", "🤝", "🙏", "✍️", "💅", "🤳", "💪", "🦾", "🦵", "🦿", "🦶", "👣", "👂", "🦻", "👃", "🧠", "🦷", "🦴", "👀", "👅", "👄", "💋", "🩸", "🔥", "👶", "👧", "🧒", "👦", "👩", "🧑", "👨", "👩‍🦱", "👨‍🦱", "👩‍🦰", "👨‍🦰", "👱‍♀️", "👱", "👱‍♂️", "👩‍🦳", "👨‍🦳", "👩‍🦲", "👨‍🦲", "🧔", "👵", "🧓", "👴", "👲", "👳‍♀️", "👳", "👳‍♂️", "🧕", "👮‍♀️", "👮", "👮‍♂️",
    "👷‍♀️", "👷", "👷‍♂️", "💂‍♀️", "💂", "💂‍♂️", "🕵️‍♀️", "🕵️", "🕵️‍♂️", "👩‍⚕️", "👨‍⚕️", "👩‍🌾", "👨‍🌾", "👩‍🍳", "👨‍🍳", "👩‍🎓", "👨‍🎓", "👩‍🎤", "👨‍🎤", "👩‍🏫", "👨‍🏫", "👩‍🏭", "👨‍🏭", "👩‍💻", "👨‍💻", "👩‍💼", "👨‍💼", "👩‍🔧", "👨‍🔧", "👩‍🔬", "👨‍🔬", "👩‍🎨", "👨‍🎨", "👩‍🚒", "👨‍🚒", "👩‍✈️", "👨‍✈️", "👩‍🚀", "👨‍🚀", "👩‍⚖️", "👨‍⚖️", "👰", "🤵", "👸", "🤴", "🦸‍♀️", "🦸", "🦸‍♂️", "🦹‍♀️", "🦹", "🦹‍♂️", "🤶", "🎅", "🧙‍♀️", "🧙", "🧙‍♂️", "🧝‍♀️", "🧝", "🧝‍♂️", "🧛‍♀️", "🧛", "🧛‍♂️", "🧟‍♀️", "🧟", "🧟‍♂️", "🧞‍♀️", "🧞", "🧞‍♂️", "🧜‍♀️", "🧜", "🧜‍♂️", "🧚‍♀️", "🧚", "🧚‍♂️", "👼", "🤰", "🤱", "🙇‍♀️", "🙇", "🙇‍♂️", "💁‍♀️", "💁", "💁‍♂️", "🙅‍♀️", "🙅", "🙅‍♂️", "🙆‍♀️", "🙆", "🙆‍♂️", "🙋‍♀️", "🙋", "🙋‍♂️", "🧏‍♀️", "🧏", "🧏‍♂️", "🤦‍♀️", "🤦", "🤦‍♂️", "🤷‍♀️", "🤷", "🤷‍♂️", "🙎‍♀️", "🙎", "🙎‍♂️", "🙍‍♀️", "🙍", "🙍‍♂️", "💇‍♀️", "💇", "💇‍♂️", "💆‍♀️", "💆", "💆‍♂️", "🧖‍♀️", "🧖", "🧖‍♂️", "💅", "🤳", "💃", "🕺", "👯‍♀️", "👯", "👯‍♂️", "🕴", "👩‍🦽", "🧑‍🦽", "👨‍🦽", "👩‍🦼", "🧑‍🦼", "👨‍🦼", "🚶‍♀️", "🚶", "🚶‍♂️", "👩‍🦯", "🧑‍🦯", "👨‍🦯",
    "🧎‍♀️", "🧎", "🧎‍♂️", "🏃‍♀️", "🏃", "🏃‍♂️", "🧍‍♀️", "🧍", "🧍‍♂️", "👭", "🧑‍🤝‍🧑", "👬", "👫", "👩‍❤️‍👩", "💑", "👨‍❤️‍👨", "👩‍❤️‍👨", "👩‍❤️‍💋‍👩", "💏", "👨‍❤️‍💋‍👨", "👩‍❤️‍💋‍👨", "👪",
    "👨‍👩‍👦",
    "👨‍👩‍👧",
    "👨‍👩‍👧‍👦",
    "👨‍👩‍👦‍👦",
    "👨‍👩‍👧‍👧",
    "👨‍👨‍👦",
    "👨‍👨‍👧",
    "👨‍👨‍👧‍👦",
    "👨‍👨‍👦‍👦",
    "👨‍👨‍👧‍👧",
    "👩‍👩‍👦",
    "👩‍👩‍👧",
    "👩‍👩‍👧‍👦",
    "👩‍👩‍👦‍👦",
    "👩‍👩‍👧‍👧",
    "👨‍👦",
    "👨‍👦‍👦",
    "👨‍👧",
    "👨‍👧‍👦",
    "👨‍👧‍👧",
    "👩‍👦",
    "👩‍👦‍👦",
    "👩‍👧",
    "👩‍👧‍👦",
    "👩‍👧‍👧",
    "🗣",
    "👤",
    "👥",
    "🌂",
    "☂️",
    "🧵",
    "🪡",
    "🪢",
    "🧶",
    "👓",
    "🕶",
    "🥽",
    "🥼",
    "🦺",
    "👔",
    "👕",
    "👖",
    "🧣",
    "🧤",
    "🧥",
    "🧦",
    "👗",
    "👘",
    "🥻",
    "🩱",
    "🩲",
    "🩳",
    "👙",
    "👚",
    "👛",
    "👜",
    "👝",
    "🎒",
    "👞",
    "👟",
    "🥾",
    "🥿",
    "👠",
    "👡",
    "🩰",
    "👢",
    "👑",
    "👒",
    "🎩",
    "🎓",
    "🧢",
    "💄",
    "💍",
    "💼",
    "👋🏻",
    "🤚🏻",
    "🖐🏻",
    "✋🏻",
    "🖖🏻",
    "👌🏻",
    "🤏🏻",
    "✌🏻",
    "🤞🏻",
    "🤟🏻",
    "🤘🏻",
    "🤙🏻",
    "👈🏻",
    "👉🏻",
    "👆🏻",
    "🖕🏻",
    "👇🏻",
    "☝🏻",
    "👍🏻",
    "👎🏻",
    "✊🏻",
    "👊🏻",
    "🤛🏻",
    "🤜🏻",
    "👏🏻",
    "🙌🏻",
    "👐🏻",
    "🤲🏻",
    "🙏🏻",
    "✍🏻",
    "💅🏻",
    "🤳🏻",
    "💪🏻",
    "🦵🏻",
    "🦶🏻",
    "👂🏻",
    "🦻🏻",
    "👃🏻",
    "👶🏻",
    "👧🏻",
    "🧒🏻",
    "👦🏻",
    "👩🏻",
    "🧑🏻",
    "👨🏻",
    "👩🏻‍🦱",
    "👨🏻‍🦱",
    "👩🏻‍🦰",
    "👨🏻‍🦰",
    "👱🏻‍♀️",
    "👱🏻",
    "👱🏻‍♂️",
    "👩🏻‍🦳",
    "👨🏻‍🦳",
    "👩🏻‍🦲",
    "👨🏻‍🦲",
    "🧔🏻",
    "👵🏻",
    "🧓🏻",
    "👴🏻",
    "👲🏻",
    "👳🏻‍♀️",
    "👳🏻",
    "👳🏻‍♂️",
    "🧕🏻",
    "👮🏻‍♀️",
    "👮🏻",
    "👮🏻‍♂️",
    "👷🏻‍♀️",
    "👷🏻",
    "👷🏻‍♂️",
    "💂🏻‍♀️",
    "💂🏻",
    "💂🏻‍♂️",
    "🕵🏻‍♀️",
    "🕵🏻",
    "🕵🏻‍♂️",
    "👩🏻‍⚕️",
    "🙇🏻‍♀️",
    "🙇🏻",
    "🙇🏻‍♂️",
    "💁🏻‍♀️",
    "💁🏻",
    "💁🏻‍♂️",
    "🙅🏻‍♀️",
    "🙅🏻",
    "🙅🏻‍♂️",
    "🙆🏻‍♀️",
    "🙆🏻",
    "🙆🏻‍♂️",
    "🙋🏻‍♀️",
    "🙋🏻",
    "🙋🏻‍♂️",
    "🧏🏻‍♀️",
    "🧏🏻",
    "🧏🏻‍♂️",
    "🤦🏻‍♀️",
    "🤦🏻",
    "🤦🏻‍♂️",
    "🤷🏻‍♀️",
    "🤷🏻",
    "🤷🏻‍♂️",
    "🙎🏻‍♀️",
    "🙎🏻",
    "🙎🏻‍♂️",
    "🙍🏻‍♀️",
    "🙍🏻",
    "🙍🏻‍♂️",
    "💇🏻‍♀️",
    "💇🏻",
    "💇🏻‍♂️",
    "💆🏻‍♀️",
    "💆🏻",
    "💆🏻‍♂️",
    "🧖🏻‍♀️",
    "🧖🏻",
    "🧖🏻‍♂️",
    "💃🏻",
    "🕺🏻",
    "🕴🏻",
    "👩🏻‍🦽",
    "👨🏻‍🦽",
    "👩🏻‍🦼",
    "👨🏻‍🦼",
    "🚶🏻‍♀️",
    "🚶🏻",
    "🚶🏻‍♂️",
    "👩🏻‍🦯",
    "👨🏻‍🦯",
    "🧎🏻‍♀️",
    "🧎🏻",
    "🧎🏻‍♂️",
    "🏃🏻‍♀️",
    "🏃🏻",
    "🏃🏻‍♂️",
    "🧍🏻‍♀️",
    "🧍🏻",
    "🧍🏻‍♂️",
    "👭🏻",
    "🧑🏻‍🤝‍🧑🏻",
    "👬🏻",
    "👫🏻",
    "🧗🏻‍♀️",
    "🧗🏻",
    "🧗🏻‍♂️",
    "🏇🏻",
    "🏂🏻",
    "🏌🏻‍♀️",
    "🏌🏻",
    "🏌🏻‍♂️",
    "🏄🏻‍♀️",
    "🏄🏻",
    "🏄🏻‍♂️",
    "🚣🏻‍♀️",
    "🚣🏻",
    "🚣🏻‍♂️",
    "🏊🏻‍♀️",
    "🏊🏻",
    "🏊🏻‍♂️",
    "⛹🏻‍♀️",
    "⛹🏻",
    "⛹🏻‍♂️",
    "🏋🏻‍♀️",
    "🏋🏻",
    "🏋🏻‍♂️",
    "🚴🏻‍♀️",
    "🚴🏻",
    "🚴🏻‍♂️",
    "🚵🏻‍♀️",
    "🚵🏻",
    "🚵🏻‍♂️",
    "🤸🏻‍♀️",
    "🤸🏻",
    "🤸🏻‍♂️",
    "🤽🏻‍♀️",
    "🤽🏻",
    "🤽🏻‍♂️",
    "🤾🏻‍♀️",
    "🤾🏻",
    "🤾🏻‍♂️",
    "🤹🏻‍♀️",
    "🤹🏻",
    "🤹🏻‍♂️",
    "🧘🏻‍♀️",
    "🧘🏻",
    "🧘🏻‍♂️",
    "🛀🏻",
    "🛌🏻",
    "🍏",
    "🍎",
    "🍐",
    "🍊",
    "🍋",
    "🍌",
    "🍉",
    "🍇",
    "🍓",
    "🍈",
    "🍒",
    "🍑",
    "🥭",
    "🍍",
    "🥥",
    "🥝",
    "🍅",
    "🍆",
    "🥑",
    "🥦",
    "🥬",
    "🥒",
    "🌶",
    "🌽",
    "🥕",
    "🧄",
    "🧅",
    "🥔",
    "🍠",
    "🥐",
    "🥯",
    "🍞",
    "🥖",
    "🥨",
    "🧀",
    "🥚",
    "🍳",
    "🧈",
    "🥞",
    "🧇",
    "🥓",
    "🥩",
    "🍗",
    "🍖",
    "🦴",
    "🌭",
    "🍔",
    "🍟",
    "🍕",
    "🥪",
    "🥙",
    "🧆",
    "🌮",
    "🌯",
    "🥗",
    "🥘",
    "🥫",
    "🍝",
    "🍜",
    "🍲",
    "🍛",
    "🍣",
    "🍱",
    "🥟",
    "🦪",
    "🍤",
    "🍙",
    "🍚",
    "🍘",
    "🍥",
    "🥠",
    "🥮",
    "🍢",
    "🍡",
    "🍧",
    "🍨",
    "🍦",
    "🥧",
    "🧁",
    "🍰",
    "🎂",
    "🍮",
    "🍭",
    "🍬",
    "🍫",
    "🍿",
    "🍩",
    "🍪",
    "🌰",
    "🥜",
    "🍯",
    "🥛",
    "🍼",
    "☕️",
    "🍵",
    "🧃",
    "🥤",
    "🧋",
    "🍶",
    "🍺",
    "🍻",
    "🥂",
    "🍷",
    "🥃",
    "🍸",
    "🍹",
    "🧉",
    "🍾",
    "🧊",
    "🥄",
    "🍴",
    "🍽",
    "🥣",
    "🥡",
    "🥢",
    "🧂",
    "❤️",
    "🧡",
    "💛",
    "💚",
    "💙",
    "💜",
    "🖤",
    "🤍",
    "🤎",
    "💔",
    "❣️",
    "💕",
    "💞",
    "💓",
    "💗",
    "💖",
    "💘",
    "💝",
    "💟",
    "☮️",
    "✝️",
    "☪️",
    "🕉",
    "☸️",
    "✡️",
    "🔯",
    "🕎",
    "☯️",
    "☦️",
    "🛐",
    "⛎",
    "♈️",
    "♉️",
    "♊️",
    "♋️",
    "♌️",
    "♍️",
    "♎️",
    "♏️",
    "♐️",
    "♑️",
    "♒️",
    "♓️",
    "🆔",
    "⚛️",
    "🉑",
    "☢️",
    "☣️",
    "📴",
    "📳",
    "🈶",
    "🈚️",
    "🈸",
    "🈺",
    "🈷️",
    "✴️",
    "🆚",
    "💮",
    "🉐",
    "㊙️",
    "㊗️",
    "🈴",
    "🈵",
    "🈹",
    "🈲",
    "🅰️",
    "🅱️",
    "🆎",
    "🆑",
    "🅾️",
    "🆘",
    "❌",
    "⭕️",
    "🛑",
    "⛔️",
    "📛",
    "🚫",
    "💯",
    "💢",
    "♨️",
    "🚷",
    "🚯",
    "🚳",
    "🚱",
    "🔞",
    "📵",
    "🚭",
    "❗️",
    "❕",
    "❓",
    "❔",
    "‼️",
    "⁉️",
    "🔅",
    "🔆",
    "〽️",
    "⚠️",
    "🚸",
    "🔱",
    "⚜️",
    "🔰",
    "♻️",
    "✅",
    "🈯️",
    "💹",
    "❇️",
    "✳️",
    "❎",
    "🌐",
    "💠",
    "Ⓜ️",
    "🌀",
    "💤",
    "🏧",
    "🚾",
    "♿️",
    "🅿️",
    "🈳",
    "🈂️",
    "🛂",
    "🛃",
    "🛄",
    "🛅",
    "🚹",
    "🚺",
    "🚼",
    "⚧",
    "🚻",
    "🚮",
    "🎦",
    "📶",
    "🈁",
    "🔣",
    "🔤",
    "🔡",
    "🔠",
    "🆖",
    "🆗",
    "🆙",
    "🆒",
    "🆕",
    "🆓",
    "0️⃣",
    "1️⃣",
    "2️⃣",
    "3️⃣",
    "4️⃣",
    "5️⃣",
    "6️⃣",
    "7️⃣",
    "8️⃣",
    "9️⃣",
    "🔟",
    "🔢",
    "#️⃣",
    "*️⃣",
    "⏏️",
    "▶️",
    "⏸",
    "⏯",
    "⏹",
    "⏺",
    "⏭",
    "⏮",
    "⏩",
    "⏪",
    "⏫",
    "⏬",
    "◀️",
    "🔼",
    "🔽",
    "➡️",
    "⬅️",
    "⬆️",
    "⬇️",
    "↗️",
    "↘️",
    "↙️",
    "↖️",
    "↕️",
    "↔️",
    "↪️",
    "↩️",
    "⤴️",
    "⤵️",
    "🔀",
    "🔁",
    "🔂",
    "🔄",
    "🔃",
    "🎵",
    "🎶",
    "➕",
    "➖",
    "➗",
    "✖️",
    "💲",
    "💱",
    "〰️",
    "➿",
    "🔚",
    "🔙",
    "🔛",
    "🔝",
    "🔜",
    "✔️",
    "☑️",
    "🔘",
    "🔴",
    "🟠",
    "🟡",
    "🟢",
    "🔵",
    "🟣",
    "⚫️",
    "⚪️",
    "🟤",
    "🔺",
    "🔻",
    "🔸",
    "🔹",
    "🔶",
    "🔷",
    "🔳",
    "🔲",
    "🟥",
    "🟧",
    "🟨",
    "🟩",
    "🟦",
    "🟪",
    "⬛️",
    "⬜️",
    "🟫",
    "🔈",
    "🔇",
    "🔉",
    "🔊",
    "🔔",
    "🔕",
    "📣",
    "📢",
    "👁‍🗨",
    "💬",
    "💭",
    "🃏",
    "🎴",
    "🀄️",
    "🕐",
    "🕑",
    "🕒",
    "🕓",
    "🕔",
    "🕕",
    "🕖",
    "🕗",
    "🕘",
    "🕙",
    "🕚",
    "🕛",
    "🕜",
    "🕝",
    "🕞",
    "🕟",
    "🕠",
    "🕡",
    "🕢",
    "🕣",
    "🕤",
    "🕥",
    "🕦",
    "🕧",
  ];
  constructor(public service: WebSocketService, public helper: HelperService, private DS: DomSanitizer) {
  }

  updateFrame(chatSection: any) {
    chatSection.scrollTo(0, chatSection.scrollHeight)
  }

  closeImageInpContainer(display: HTMLElement) {
    this.status = 'none';
    display.style.transform = "scale(0)";
  }

  addEmojiToText(emoji: string, emojiContainer: HTMLElement, message:any) {
    message.value += emoji;
    this.closeEmojiContainer(emojiContainer);
  }

  closeEmojiContainer(emojiContainer: HTMLElement) {
    emojiContainer.style.transform = 'scale(0)';
    emojiContainer.style.zIndex = '0';
    this.toggledEmojiCont = !this.toggledEmojiCont;
  }

  sendImage(display: HTMLElement, btn: HTMLElement) {
    this.status = 'static';
    display.style.transform = "scale(1)";
    btn.click();
    btn.addEventListener('change', (e: any) => {
      const fileList = e.target.files;
      this.file = fileList[0];
      console.log(fileList[0]);
      this.imgURL = this.DS.bypassSecurityTrustUrl(URL.createObjectURL(e.target.files[0]));
    })
  }

  displayEmojiContainer(emojiContainer: HTMLElement) {
    if (!this.toggledEmojiCont) {
      this.toggledEmojiCont = !this.toggledEmojiCont;
      emojiContainer.style.transform = 'scale(1)';
      emojiContainer.style.zIndex = '1000';
    } else{
      this.closeEmojiContainer(emojiContainer);
    }

  }

  uploadImage(display: HTMLElement, message: HTMLElement, chatSection: HTMLElement) {
    let formData = new FormData();
    formData.append('image', this.file);

    fetch("http://localhost:5000/uploadImage", {
      method: "POST",
      body: formData
    })
      .then(response => {
        this.closeImageInpContainer(display);
        return response.json()
      })
      .then(data => {
        this.service.sendMessage(data.url, message, chatSection)
        console.log(data.url)
      })
      .catch(err => console.log(err));
  }
}
